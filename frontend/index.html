<!doctype html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Erasmus Help Desk</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="app-header">
      <div class="header-left">
        <div class="logo"></div>
        <div>
          <div class="title">Erasmus Help Desk</div>
          <div class="subtitle">Match mete • Esami compatibili • Fonti</div>
        </div>
      </div>
      <div class="header-right">
        <div class="api-control">
          <label for="api_base" class="label">API Base</label>
          <input id="api_base" class="input" placeholder="http://127.0.0.1:8000" />
          <button id="save_api_btn" class="btn btn-primary btn-full">Salva</button>
          <span id="saved_flag" class="saved-flag" hidden>Salvato ✔</span>
        </div>
        <label class="checkbox">
          <input type="checkbox" id="mock_mode" />
          Mock mode
        </label>
        <button id="reset_btn" class="btn">Reset</button>
      </div>
    </header>

    <main class="container">
      <div id="stepper" class="stepper" aria-label="Step progress">
        <!-- Render dinamico -->
      </div>

      <div class="grid">
        <!-- Colonna sinistra: form -->
        <section class="col-left">
          <div class="card">
            <div class="card-title">1) Università di provenienza</div>
            <div class="space-y">
              <div class="space-y-xxs">
                <label for="university" class="label">Ateneo <span class="required" aria-hidden="true">*</span></label>
                <input id="university" class="input" placeholder="Es. Università di Pisa" />
              </div>
              <button id="find_bando_btn" class="btn btn-primary btn-full">Cerca bando</button>
            </div>
          </div>

          <div class="card">
            <div class="card-title">2) Dipartimento &amp; periodo</div>
            <div class="space-y">
              <div class="space-y-xxs">
                <label for="dept" class="label">Dipartimento <span class="required" aria-hidden="true">*</span></label>
                <input id="dept" class="input" placeholder="Es. Ingegneria Informatica" />
              </div>
              <div class="space-y-xxs">
                <label for="period" class="label">Semestre <span class="required" aria-hidden="true">*</span></label>
                <select id="period" class="select">
                  <option value="Fall">Fall</option>
                  <option value="Spring">Spring</option>
                </select>
              </div>
              <div class="space-y-xxs">
                <label for="study" class="label">Piano di studi (testo libero)</label>
                <textarea id="study" class="textarea" rows="5" placeholder="Elenca esami sostenuti/da sostenere, prerequisiti, preferenze…"></textarea>
              </div>

              <!-- Step 2: Upload Piano di Studi (PDF obbligatorio) -->
              <div class="space-y-xxs" id="study_pdf_block" style="margin-bottom:12px;">
                <label for="study_pdf" class="label">Carica piano di studi (PDF) <span class="required" aria-hidden="true">*</span></label>
                <div style="display:flex; gap:8px; align-items:center;">
                  <button type="button" id="select_pdf_btn" class="btn">Seleziona PDF</button>
                  <div id="study_pdf_name" class="text-muted" aria-live="polite" aria-atomic="true">Nessun file selezionato</div>
                </div>
                <div id="study_pdf_dropzone" class="dropzone" tabindex="0" aria-label="Trascina qui il PDF del piano di studi" style="margin-top:8px; padding:12px;">
                  <div class="dz-inner">
                    <div class="dz-title">Trascina qui il PDF</div>
                    <div class="dz-sub">oppure clicca per selezionarlo</div>
                  </div>
                </div>
                <!-- Input file reale (nascosto ma accessibile da JS) -->
                <input id="study_pdf" type="file" accept="application/pdf" hidden />
              </div>

              <div>
                <button id="shortlist_btn" class="btn btn-primary btn-full">Genera shortlist mete</button>
              </div>
            </div>
          </div>
        </section>

        <!-- Colonna destra: risultati -->
        <section class="col-right">
          <div class="card">
            <div class="card-title">Esito Step 1 – Riassunto bando</div>
            <div id="bando_box" class="text-muted">Inserisci l'ateneo e clicca “Cerca bando”.</div>
          </div>

          <div class="card">
            <div class="card-title">Esito Step 2 – Shortlist mete</div>
            <div id="shortlist_box" class="text-muted">Compila dipartimento/semestre/piano di studi e genera la shortlist.</div>
          </div>

          <div class="card">
            <div class="card-title">Esito Step 3 – Esami &amp; compatibilità</div>
            <div id="exams_box" class="text-muted">Seleziona una meta per vedere gli esami.</div>
          </div>

          <div id="error_box" class="card error" hidden></div>
        </section>
      </div>

      <footer class="footer">
        Questo prototipo segue il flusso a 3 passaggi (bando → mete → esami) e visualizza le citazioni quando disponibili.
      </footer>
    </main>

    <div id="global_spinner" class="spinner-backdrop" hidden>
      <div class="spinner" aria-label="Loading"></div>
    </div>

    <script defer src="app.js"></script>
  </body>
</html>
